
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Plumbing & Mechanical Blueprint Estimation</title>-->

<!--    <style>-->
<!--        * { margin: 0; padding: 0; box-sizing: border-box; }-->

<!--        body {-->
<!--            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;-->
<!--            background: #f0f2f5;-->
<!--            min-height: 100vh;-->
<!--        }-->

<!--        .header {-->
<!--            background: linear-gradient(135deg, #1e3c72, #2a5298);-->
<!--            color: white;-->
<!--            padding: 15px 0;-->
<!--        }-->

<!--        .header-content {-->
<!--            max-width: 1200px;-->
<!--            margin: auto;-->
<!--            padding: 0 20px;-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .logo-section {-->
<!--            display: flex;-->
<!--            gap: 12px;-->
<!--            align-items: center;-->
<!--        }-->

<!--        .logo-icon {-->
<!--            background: white;-->
<!--            color: #1e3c72;-->
<!--            padding: 8px;-->
<!--            border-radius: 8px;-->
<!--            font-size: 22px;-->
<!--        }-->

<!--        .container {-->
<!--            max-width: 1200px;-->
<!--            margin: 30px auto;-->
<!--            padding: 0 20px;-->
<!--        }-->

<!--        .card {-->
<!--            background: white;-->
<!--            padding: 30px;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: 0 2px 10px rgba(0,0,0,0.08);-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        .section-title {-->
<!--            font-size: 22px;-->
<!--            color: #1e3c72;-->
<!--            margin-bottom: 5px;-->
<!--        }-->

<!--        .section-subtitle {-->
<!--            color: #666;-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        .upload-area {-->
<!--            border: 2px dashed #4a90e2;-->
<!--            padding: 40px;-->
<!--            border-radius: 12px;-->
<!--            text-align: center;-->
<!--            cursor: pointer;-->
<!--            background: #f8fbff;-->
<!--        }-->

<!--        .upload-area.dragover {-->
<!--            background: #e8f4ff;-->
<!--        }-->

<!--        .upload-icon {-->
<!--            font-size: 48px;-->
<!--            margin-bottom: 10px;-->
<!--        }-->

<!--        input[type="file"] {-->
<!--            display: none;-->
<!--        }-->

<!--        .controls-row {-->
<!--            display: grid;-->
<!--            grid-template-columns: 1fr 2fr;-->
<!--            gap: 20px;-->
<!--            margin: 20px 0;-->
<!--        }-->

<!--        .type-buttons {-->
<!--            display: flex;-->
<!--            gap: 10px;-->
<!--        }-->

<!--        .type-btn {-->
<!--            flex: 1;-->
<!--            padding: 10px;-->
<!--            border-radius: 8px;-->
<!--            border: 2px solid #ccc;-->
<!--            cursor: pointer;-->
<!--            background: white;-->
<!--        }-->

<!--        .type-btn.active {-->
<!--            background: #4a90e2;-->
<!--            color: white;-->
<!--            border-color: #4a90e2;-->
<!--        }-->

<!--        .analyze-btn {-->
<!--            width: 100%;-->
<!--            padding: 15px;-->
<!--            font-size: 16px;-->
<!--            font-weight: bold;-->
<!--            background: linear-gradient(135deg, #4a90e2, #357abd);-->
<!--            border: none;-->
<!--            color: white;-->
<!--            border-radius: 8px;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .loading {-->
<!--            text-align: center;-->
<!--            padding: 30px;-->
<!--            display: none;-->
<!--        }-->

<!--        .spinner {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--            border: 4px solid #ddd;-->
<!--            border-top: 4px solid #4a90e2;-->
<!--            border-radius: 50%;-->
<!--            animation: spin 1s linear infinite;-->
<!--            margin: auto;-->
<!--        }-->

<!--        @keyframes spin {-->
<!--            100% { transform: rotate(360deg); }-->
<!--        }-->

<!--        .error-message {-->
<!--            background: #fee;-->
<!--            color: #c33;-->
<!--            padding: 12px;-->
<!--            border-radius: 8px;-->
<!--            display: none;-->
<!--            margin-top: 15px;-->
<!--        }-->

<!--        .results-section {-->
<!--            display: none;-->
<!--        }-->

<!--        .stats-grid {-->
<!--            display: grid;-->
<!--            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));-->
<!--            gap: 20px;-->
<!--        }-->

<!--        .stat-card {-->
<!--            padding: 20px;-->
<!--            border-radius: 12px;-->
<!--            border: 2px solid #e8f4ff;-->
<!--            text-align: center;-->
<!--        }-->

<!--        .stat-label {-->
<!--            font-size: 14px;-->
<!--            color: #666;-->
<!--            margin-bottom: 10px;-->
<!--        }-->

<!--        .stat-value {-->
<!--            font-size: 34px;-->
<!--            color: #1e3c72;-->
<!--            font-weight: bold;-->
<!--        }-->

<!--        .image-preview {-->
<!--            margin-top: 20px;-->
<!--            display: none;-->
<!--        }-->

<!--        .image-preview img {-->
<!--            width: 100%;-->
<!--            border-radius: 8px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->

<!--<body>-->

<!--<div class="header">-->
<!--    <div class="header-content">-->
<!--        <div class="logo-section">-->
<!--            <div class="logo-icon">üè†</div>-->
<!--            <h2>Blueprint Estimation</h2>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<div class="container">-->

<!--    &lt;!&ndash; Upload Card &ndash;&gt;-->
<!--    <div class="card">-->
<!--        <h2 class="section-title">Upload Blueprint</h2>-->
<!--        <p class="section-subtitle">Analyze blueprint and detect symbols</p>-->

<!--        <div class="upload-area" id="uploadArea">-->
<!--            <div class="upload-icon">üìã</div>-->
<!--            <div>Drag & Drop or Click to Upload</div>-->
<!--            <input type="file" id="pdfFile" accept="image/*,application/pdf">-->
<!--        </div>-->

<!--        <div class="controls-row">-->
<!--            <select id="scaleSelect">-->
<!--                <option value="1:100">1:100</option>-->
<!--                <option value="1:50">1:50</option>-->
<!--            </select>-->

<!--            <div class="type-buttons">-->
<!--                <button class="type-btn active" data-type="pdf">PDF</button>-->
<!--                <button class="type-btn" data-type="image">Image</button>-->
<!--                <button class="type-btn" data-type="cad">CAD</button>-->
<!--            </div>-->
<!--        </div>-->

<!--        <button class="analyze-btn" id="analyzeBtn">Analyze Blueprint</button>-->

<!--        <div class="loading" id="loading">-->
<!--            <div class="spinner"></div>-->
<!--            <p>Analyzing...</p>-->
<!--        </div>-->

<!--        <div class="error-message" id="errorMessage"></div>-->

<!--        <div class="image-preview" id="imagePreview">-->
<!--            <img id="previewImg">-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Results &ndash;&gt;-->
<!--    <div class="card results-section" id="resultsSection">-->
<!--        <h2 class="section-title">Estimation Results</h2>-->
<!--        <div class="stats-grid" id="statsGrid"></div>-->
<!--    </div>-->

<!--</div>-->

<!--<script>-->
<!--const uploadArea = document.getElementById('uploadArea');-->
<!--const pdfFile = document.getElementById('pdfFile');-->
<!--const analyzeBtn = document.getElementById('analyzeBtn');-->
<!--const loading = document.getElementById('loading');-->
<!--const errorMessage = document.getElementById('errorMessage');-->
<!--const resultsSection = document.getElementById('resultsSection');-->
<!--const statsGrid = document.getElementById('statsGrid');-->
<!--const imagePreview = document.getElementById('imagePreview');-->
<!--const previewImg = document.getElementById('previewImg');-->

<!--let selectedBlueprintType = 'pdf';-->
<!--let currentData = null;-->

<!--/* Type buttons */-->
<!--document.querySelectorAll('.type-btn').forEach(btn => {-->
<!--    btn.onclick = () => {-->
<!--        document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));-->
<!--        btn.classList.add('active');-->
<!--        selectedBlueprintType = btn.dataset.type;-->
<!--    };-->
<!--});-->

<!--/* Upload */-->
<!--uploadArea.onclick = () => pdfFile.click();-->

<!--uploadArea.ondragover = e => {-->
<!--    e.preventDefault();-->
<!--    uploadArea.classList.add('dragover');-->
<!--};-->

<!--uploadArea.ondragleave = () => uploadArea.classList.remove('dragover');-->

<!--uploadArea.ondrop = e => {-->
<!--    e.preventDefault();-->
<!--    uploadArea.classList.remove('dragover');-->
<!--    pdfFile.files = e.dataTransfer.files;-->
<!--};-->

<!--/* Analyze */-->
<!--analyzeBtn.onclick = async () => {-->
<!--    if (!pdfFile.files.length) {-->
<!--        showError("Please upload a file");-->
<!--        return;-->
<!--    }-->

<!--    loading.style.display = 'block';-->
<!--    resultsSection.style.display = 'none';-->
<!--    errorMessage.style.display = 'none';-->

<!--    const formData = new FormData();-->
<!--    formData.append('file', pdfFile.files[0]);-->
<!--    formData.append('type', selectedBlueprintType);-->

<!--    try {-->
<!--        const res = await fetch('/analyze', {-->
<!--            method: 'POST',-->
<!--            body: formData-->
<!--        });-->

<!--        const data = await res.json();-->
<!--        if (!data.success) throw new Error("Analysis failed");-->

<!--        currentData = data;-->
<!--        renderResults(data);-->

<!--    } catch (err) {-->
<!--        showError(err.message);-->
<!--    } finally {-->
<!--        loading.style.display = 'none';-->
<!--    }-->
<!--};-->

<!--/* Render Results */-->
<!--function renderResults(data) {-->
<!--    statsGrid.innerHTML = '';-->

<!--    // Total symbols-->
<!--    statsGrid.innerHTML += `-->
<!--        <div class="stat-card">-->
<!--            <div class="stat-label">Total Symbols</div>-->
<!--            <div class="stat-value">${data.total_symbols}</div>-->
<!--        </div>-->
<!--    `;-->

<!--    // Dynamic symbols-->
<!--    Object.entries(data.symbols).forEach(([name, count]) => {-->
<!--        statsGrid.innerHTML += `-->
<!--            <div class="stat-card">-->
<!--                <div class="stat-label">${name}</div>-->
<!--                <div class="stat-value">${count}</div>-->
<!--            </div>-->
<!--        `;-->
<!--    });-->

<!--    // Annotated image-->
<!--    if (data.annotated_images?.length) {-->
<!--        previewImg.src = data.annotated_images[0];-->
<!--        imagePreview.style.display = 'block';-->
<!--    }-->

<!--    resultsSection.style.display = 'block';-->
<!--}-->

<!--/* Error */-->
<!--function showError(msg) {-->
<!--    errorMessage.textContent = msg;-->
<!--    errorMessage.style.display = 'block';-->
<!--}-->
<!--</script>-->

<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plumbing & Mechanical Blueprint Estimation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 15px 0;
        }

        .header-content {
            max-width: 1200px;
            margin: auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            background: white;
            color: #1e3c72;
            padding: 8px;
            border-radius: 8px;
            font-size: 22px;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 22px;
            color: #1e3c72;
            margin-bottom: 8px;
        }

        .section-subtitle {
            color: #666;
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #4a90e2;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            background: #f8fbff;
        }

        .upload-area.dragover {
            background: #e8f4ff;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        input[type="file"] {
            display: none;
        }

        .analyze-btn {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 30px;
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #ddd;
            border-top: 4px solid #4a90e2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: auto;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 12px;
            border-radius: 8px;
            display: none;
            margin-top: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e8f4ff;
            text-align: center;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            color: #1e3c72;
            font-weight: bold;
        }

        .bill-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .bill-table th {
            background: #1e3c72;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .bill-table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        .bill-table tr:hover {
            background: #f8fbff;
        }

        tfoot td {
            background: #f0f6ff;
        }
    </style>
</head>

<body>

<div class="header">
    <div class="header-content">
        <div class="logo-icon">üè†</div>
        <h2>Blueprint Estimation</h2>
    </div>
</div>

<div class="container">

    <div class="card">
        <h2 class="section-title">Upload Blueprint (PDF)</h2>
        <p class="section-subtitle">Analyze blueprint and detect symbols</p>

        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">üìÑ</div>
            <div>Drag & Drop or Click to Upload PDF</div>
            <input type="file" id="pdfFile" accept="application/pdf">
        </div>

        <button class="analyze-btn" id="analyzeBtn">Analyze Blueprint</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing PDF‚Ä¶</p>
        </div>

        <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="card" id="resultsSection" style="display:none;">
        <h2 class="section-title">Estimation Results</h2>
        <div class="stats-grid" id="statsGrid"></div>
    </div>

    <div class="card" id="billSection" style="display:none;">
        <h2 class="section-title">Bill</h2>

        <table class="bill-table">
            <thead>
                <tr>
                    <th>Symbol Name</th>
                    <th>Count</th>
                    <th>Price</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody id="billTableBody"></tbody>
            <tfoot>
                <tr>
                    <td colspan="3" style="text-align:right;font-weight:bold;">Overall Total</td>
                    <td id="overallTotal" style="font-weight:bold;">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

</div>

<script>
const uploadArea = document.getElementById('uploadArea');
const pdfFile = document.getElementById('pdfFile');
const analyzeBtn = document.getElementById('analyzeBtn');
const loading = document.getElementById('loading');
const errorMessage = document.getElementById('errorMessage');
const statsGrid = document.getElementById('statsGrid');
const resultsSection = document.getElementById('resultsSection');
const billSection = document.getElementById('billSection');
const billTableBody = document.getElementById('billTableBody');
const overallTotalEl = document.getElementById('overallTotal');

uploadArea.onclick = () => pdfFile.click();

uploadArea.ondragover = e => {
    e.preventDefault();
    uploadArea.classList.add('dragover');
};

uploadArea.ondragleave = () => uploadArea.classList.remove('dragover');

uploadArea.ondrop = e => {
    e.preventDefault();
    uploadArea.classList.remove('dragover');
    pdfFile.files = e.dataTransfer.files;
};

const PRICE_LIST = {
    "45 RADIUS ELBOW": 120,
    "90 RADIUS ELBOW": 150,
    "RETURN OR EXHAUST DIFFUSER": 500,
    "RETURN-EXHAUST OR OUTSIDE AIR RISE": 800,
    "SUPPLY AIR RISE": 700
};

analyzeBtn.onclick = async () => {
    if (!pdfFile.files.length) {
        showError("Please upload a PDF file");
        return;
    }

    loading.style.display = 'block';
    errorMessage.style.display = 'none';

    const formData = new FormData();
    formData.append('file', pdfFile.files[0]);

    try {
        const res = await fetch('/analyze', { method: 'POST', body: formData });
        const data = await res.json();
        if (!data.success) throw new Error(data.error);
        renderResults(data);
    } catch (err) {
        showError(err.message);
    } finally {
        loading.style.display = 'none';
    }
};

function renderResults(data) {
    statsGrid.innerHTML = '';
    billTableBody.innerHTML = '';
    let overallTotal = 0;

    statsGrid.innerHTML += `
        <div class="stat-card">
            <div class="stat-label">Total Symbols</div>
            <div class="stat-value">${data.total_symbols}</div>
        </div>
    `;

    Object.entries(data.symbols)
        .filter(([name]) => name.toLowerCase() !== "door")
        .forEach(([name, count]) => {

            statsGrid.innerHTML += `
                <div class="stat-card">
                    <div class="stat-label">${name}</div>
                    <div class="stat-value">${count}</div>
                </div>
            `;

            const price = PRICE_LIST[name] || 0;
            const total = price * count;
            overallTotal += total;

            billTableBody.innerHTML += `
                <tr>
                    <td>${name}</td>
                    <td>${count}</td>
                    <td>${price}</td>
                    <td>${total}</td>
                </tr>
            `;
        });

    overallTotalEl.textContent = overallTotal;
    resultsSection.style.display = 'block';
    billSection.style.display = 'block';
}

function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.style.display = 'block';
}
</script>

</body>
</html>



